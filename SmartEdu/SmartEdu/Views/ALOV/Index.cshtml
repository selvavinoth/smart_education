@model  SmartEdu.ViewModel.AdmLovViewModel
@using SmartEdu.Helper
@{
    ViewBag.Title = "Index";
}
@{
    Layout = null;        
}
@Html.Partial("_Scripts")
@Html.Partial("_GridScript")
@Html.Partial("_BootStrap")
<div id="pageMainDiv" align="center" style="padding-top: 50px;">
    <table cellpadding="0" cellspacing="0" border="0">
        <tr>
            <td class="gridAction">
                <table cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td class="AddIcon">
                            <label onclick="fnAdd();">
                                @ResourceKeeper.GetResource("CMN_Add")
                                
                            </label>
                        </td>
                        <td class="EditIcon">
                            <label onclick="fnEdit('0',false);">
                                @ResourceKeeper.GetResource("CMN_Edit")
                            </label>
                        </td>
                        <td class="DeleteIcon">
                            <label onclick="fnDelete();">
                                @ResourceKeeper.GetResource("CMN_Delete")
                            </label>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <div id="gridbox">
                </div>
            </td>
        </tr>
    </table>
</div>
<div id="xxx" style="height:30px; top:0px;position:absolute;"></div>
<div id="contentWrapper" class="pageDimmer" style="display: none;">
</div>
<div id="popupBox" class="popup_Cotainer" style="display: none;" align="center">
    <table class="popup_Table">
        <tr>
            <td align="center" valign="middle">
                <div class="popupBox">
                    <table cellpadding="0" cellspacing="0" border="0" class="popupBoxTable">
                        <tr>
                            <td class="popupHeader">
                                <div class="popupHead">
                                    @ResourceKeeper.GetResource("APP_LOV")</div>
                                <div class="closeIcon" onclick="fnShowhidePopUp('none');">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td id="popupContent" style="height: 220px;" valign="middle" align="center">
                                @using (Html.BeginForm("ALOVIUAction", "ALOV", FormMethod.Post, new { id = "ALOVForm" }))
                                {
                                    @Html.ValidationSummary(true)

                                    <table border="0" cellspacing="0" cellpadding="0" style="width: 100%;">
                                        <tr>
                                            <td class="td_label">
                                                @Html.Label(ResourceKeeper.GetResource("APP_Code"))
                                            </td>
                                            <td class="td_text">
                                                @Html.EditorFor(model => model.AL_Code)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                @Html.ValidationMessageFor(model => model.AL_Code)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="td_label">
                                                @Html.Label(ResourceKeeper.GetResource("APP_Description"))
                                            </td>
                                            <td class="td_text">
                                                @Html.EditorFor(model => model.AL_Description)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                @Html.ValidationMessageFor(model => model.AL_Description)
                                            </td>
                                        </tr>
                                        @if(Model.Flag) { 
                                        <tr>
                                            <td colspan="2">
                                               @Html.HiddenFor(model => model.AL_Type)
                                            </td>
                                        </tr>
                                             <script type="text/javascript">
                                                 function fnLoadGrid() {
                                                     $.ajax({
                                                         url: '@Url.Content("~/ALOV/GetGridDataByType")',
                                                         type: "POST",
                                                         dataType: "Json",
                                                         data: {"type":$("#AL_Type").val() },
                                                         success: function (obj) {
                                                             if (obj && obj != null) { 
                                                           //  mygrid.clearAll(); mygrid.parse(obj, "json");
                                                              dG.parse(obj); }
                                                         },
                                                         error: function (a, b) { }
                                                     });
                                                 }
                                            </script>
                                        }
                                        else
                                        {
                                        <tr>
                                            <td class="td_label">
                                                @Html.Label(ResourceKeeper.GetResource("APP_Type"))
                                            </td>
                                            <td class="td_text">
                                                @Html.DropDownListFor(model => model.AL_Type, Model.LovTypList)
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                @Html.ValidationMessageFor(model => model.AL_Type)
                                            </td>
                                        </tr>
                                            <script type="text/javascript">
                                                function fnLoadGrid() {
                                                    $.ajax({
                                                        url: '@Url.Content("~/ALOV/GetGridData")',
                                                        type: "POST",
                                                        dataType: "Json",
                                                        data: {},
                                                        success: function (obj) {
                                                            if (obj && obj != null) { mygrid.clearAll(); mygrid.parse(obj, "json"); }
                                                        },
                                                        error: function (a, b) { }
                                                    });
                                                }
                                            </script>
                                        }
                                        <tr>
                                            <td>@Html.HiddenFor(model => model.Flag)
                                            </td>
                                            <td>@Html.HiddenFor(model => model.AL_Id)
                                            </td>
                                        </tr>
                                    </table>
                                }
                            </td>
                        </tr>
                        <tr>
                            <td align="center">
                                <input type="button" value="save" onclick="fnSave();" />
                            </td>
                        </tr>
                    </table>
                </div>
            </td>
        </tr>
    </table>
</div>
<script type="text/javascript">
    /* Method used for initialization && grid loading */
    var mygrid;
    $(function () { fnSetPageSize();   });
     function init() {
        mygrid = new dhtmlXGridObject('gridbox');
        mygrid.setImagePath("@Url.Content("~/Content/GridData/imgs/")"); //path to images required by grid
        mygrid.setHeader(',@ResourceKeeper.GetResource("APP_Type"),@ResourceKeeper.GetResource("APP_Code"),@ResourceKeeper.GetResource("APP_Description")'); //set column names
        mygrid.setInitWidths("0,*,*,*"); //set column width in px
        mygrid.setColAlign("left,left,left,left"); //set column values align
        mygrid.setColTypes("ro,ro,ro,ro"); //set column types
        mygrid.setColSorting("str,str,str,str"); //set sorting
        mygrid.attachHeader("#text_filter,#select_filter,#text_filter,#text_filter");
        mygrid.init(); //initialize grid
        mygrid.attachEvent("onRowDblClicked",function(rId,cInd){fnEdit(rId,true);});
    }
    function fnSetPageSize(){ 
    //$("#gridbox").height(String(parent.ContentHeight()-150)+"px");
     //$("#pageMainDiv").height(String(parent.ContentHeight()-50)+"px");
      }
   
    /* End o initialization */

</script>
<script type="text/javascript">
    /* Method used for Add && Edit */
    function fnAdd() { fnClearContent(); fnShowhidePopUp(""); }
    function fnEdit(id, flag) {
        if (!flag) { id = mygrid.getSelectedId(); }
        if (id == null || id == "") { alert('@ResourceKeeper.GetResource("CMN_Need_Selection")'); return false; }
        $.ajax({
            url: '@Url.Content("~/ALOV/EditLov")',
            type: "POST",
            dataType: "Json",
            data: { "id": id },
            success: function (obj) {
                if (obj && obj != null) {
                    if (obj.model && obj.model != null) { fnShowhidePopUp(""); fnFillEditData(obj.model); }
                    if (obj.Msg && obj.Msg != "") { alert(obj.Msg); }
                }
            },
            error: function (a, b) { }
        });
    }
    function fnFillEditData(obj) {
        $("#AL_Id").val(obj.AL_Id);
        $("#AL_Code").val(obj.AL_Code);
        $("#AL_Type").val(obj.AL_Type);
        $("#AL_Description").val(obj.AL_Description);
    }
    function fnSave() {
        if (!$("#ALOVForm").valid()) { return false; }
        $.ajax({
            url: '@Url.Content("~/ALOV/ALOVIUAction")',
            type: "POST",
            contentType: "application/Json",
            dataType: "JSON",
            data: JSON.stringify(fnGetViewModel()),
            success: function (obj) {
                if (obj && obj != null) {
                    if (obj.Status) {
                        if (obj.data && obj.data != null) { mygrid.clearAll(); mygrid.parse(obj.data, "json"); }
                        if (obj.isUpdate) { fnShowhidePopUp("none"); }
                        else { fnClearContent(); }
                    }
                    if (obj.Msg && obj.Msg != "") { alert(obj.Msg); }
                }
            },
            error: function (a, b) { }
        });
    }
    function fnGetViewModel() {
        var AdmLovViewModel = {};
        AdmLovViewModel.AL_Id = $("#AL_Id").val();
        AdmLovViewModel.AL_Code = $("#AL_Code").val();
        AdmLovViewModel.AL_Type = $("#AL_Type").val();
        AdmLovViewModel.AL_Description = $("#AL_Description").val();
        AdmLovViewModel.Flag = $("#Flag").val();
        return AdmLovViewModel;
    }
    /* End o Add && Edit */
</script>
<script type="text/javascript">
    /* Method used for Delete */
    function fnDelete() {
        var id = mygrid.getSelectedId();
        if (id == null || id == "") { alert('@ResourceKeeper.GetResource("CMN_Need_Selection")'); return false; }
        $.ajax({
            url: '@Url.Content("~/ALOV/Delete")',
            type: "POST",
            dataType: "Json",
            data: { "id": id,"flag":$("#Flag").val(),"type":$("#AL_Type").val() },
            success: function (obj) {
                if (obj && obj != null) {
                    if (obj.data && obj.data != null) { mygrid.clearAll(); mygrid.parse(obj.data, "json"); }
                    if (obj.Msg && obj.Msg != "") { alert(obj.Msg); }
                }
            },
            error: function (a, b) { }
        });
    }
    /* End of Delete */
    /* Common methods*/
    function fnClearContent() { $("#AL_Id").val("0"); $("#AL_Code").val("");fnClearType();  $("#AL_Description").val(""); }
    function fnClearType() {
        if (!$("#Flag").val()) { $("#AL_Type").val(""); }
    }
    function fnShowhidePopUp(val) { $("#contentWrapper").css("display", val); $("#popupBox").css("display", val); }
    /* End of common method */

//    function BootStrapGrid(id, NeedAction) {
//        this.Target = id;
//        this.Header = "";
//        this.Footer = "";
//        this.ColumnId = "";
//        this.ColumnAlign = "";
//        this.NeedAction = NeedAction;
//        this.ActionType = "";
//        this.ActionClass = "";
//        setHeader: function (header) { this.Header = header; }
//        attachFooter: function (footer) { this.Footer = footer; }
//        setActionType: function (actionType) { this.ActionType = actionType; }
//        setActionClass: function (actionClass) { this.ActionClass; }
//        setColumnId: function (columnIds) { this.ColumnId = columnIds; }
//        setColumnAlign: function (colAlign) { this.ColumnAlign = colAlign; }
//        Init: function () {
//            alert("hai mani this from boot strap;");
//        }
//    }


    var dG;
    $(function () {
        dG = new BootStrapGrid("gridbox", true, true);
        dG.setHeader("Id,Type,Code,Description");
        dG.init();
        fnLoadGrid();
    });
</script>
